# ipCamWeb

Лёгкое Node.js-приложение для просмотра видеопотока и PTZ-управления ONVIF-камерой в локальной сети. Backend проксирует RTSP → MPEG-TS для отображения в браузере через JSMpeg и выступает шлюзом для ONVIF-команд.

## Возможности
- Просмотр видеопотока через WebSocket (RTSP → MPEG-TS → JSMpeg).
- PTZ-управление (панорама, наклон, зум) через ONVIF.
- Подключение к камере по IP/логин/паролю и настройка RTSP-пути.
- Один HTML с тёмной темой и быстрыми контролами.

## Требования
- Node.js LTS.
- Установленный в системе FFmpeg (доступен как `ffmpeg`).
- Камера ONVIF/RTSP в той же сети.

## Установка и запуск
```bash
npm install
npm start
# по умолчанию сервер запустится на http://localhost:3000
```
Откройте `http://localhost:3000`, введите IP/учётные данные камеры и подключитесь. После успешного подключения появится поток и станут доступными PTZ-кнопки.

Переменная `FFMPEG_BIN` позволяет указать путь к бинарю ffmpeg, а `PORT` — порт сервера.

### Работа за прокси
Если `npm install` выводит предупреждение `npm WARN config Unknown env config "http-proxy"`, значит задана переменная окружения с дефисом
(`npm_config_http-proxy`). NPM ожидает вариант с подчёркиванием или стандартные системные переменные:
- `HTTP_PROXY` / `HTTPS_PROXY` — задают адрес прокси для всех инструментов.
- `npm_config_http_proxy` / `npm_config_https_proxy` — аналоги с подчёркиванием для NPM.
Сбросьте переменную с дефисом и используйте одну из перечисленных, чтобы предупреждение исчезло.

## API
- `POST /api/connect` — тело `{ ip, username, password, rtspPath? }`; инициирует ONVIF-сессию и запоминает RTSP-URL.
- `POST /api/ptz/move` — тело `{ x, y, z, speed }`, где `x/y` — панорама/наклон, `z` — зум, `speed` — 0.1–1.0; отправляет continuous move или стоп.
- WebSocket `/api/stream` — MPEG-TS для JSMpeg; запускается после подключения камеры.

## Структура
- `server.js` — Express-сервер, WebSocket для видеопотока, обработчики ONVIF/PTZ.
- `public/index.html` — интерфейс подключения и просмотра.
- `public/app.js` — логика вызова API, управление потоком и PTZ.
- `public/style.css` — стили тёмной темы и контролов.

## Примечания по проверке
- Без реальной камеры и корректного RTSP-URL поток не стартует; приложение вернёт ошибки API.
- FFmpeg должен быть доступен в `$PATH` или передан через `FFMPEG_BIN`.
